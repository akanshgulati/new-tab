!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,t,n){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/build/",t(t.s=33)}({0:function(e,t,n){"use strict";var r=n(1),o={get:function(e){var t=localStorage.getItem(e);return isNaN(t)?JSON.parse(t):t},set:function(e,t){if(r.a.SYNC.indexOf(e)>-1){var n={};n[e]=t,console.log(n),chrome.storage.sync.set(n)}else localStorage.setItem(e,JSON.stringify(t))},setLocal:function(e,t){localStorage.setItem(e,JSON.stringify(t))},remove:function(e){return localStorage.removeItem(e)},increment:function(e){var t=this.get(e);"number"==typeof t&&this.set(e,t+1)},append:function(e,t){var n=this.get(e)||[];n.push(t),this.set(e,n)},getMap:function(e){var t=localStorage.getItem(e);return isNaN(t)?JSON.parse(t):t},setMap:function(e,t){return localStorage.setItem(e,JSON.stringify(t))},chromeSync:{get:function(e,t){chrome.storage.sync.get(e,function(e){t(e)})},set:function(e,t,n){chrome.storage.sync.set({key:t},function(e){n(e)})}}};t.a=o},1:function(e,t,n){"use strict";t.a={THEME:{NATURE:"nature",ARCHITECTURE:"building",TRAVEL:"travel",NIGHT:"night"},STORAGE:{SHARED_DATA:"shared-data",WEATHER:"weather",BACKGROUND_SEEN:"bg-seen",CURRENT_PAGE:"current-page",SEEN_ONBOARDING:"seen-onboarding"},SYNC:["shared-data","bg-seen","current-page"]}},33:function(e,t,n){e.exports=n(5)},5:function(e,t,n){"use strict";function r(){return f!==i&&i}function o(e){i=e}function a(e){if(e&&e.photo){for(var t=Object.keys(e.photo),n=e.photo,r=s.a.get(c.a.STORAGE.BACKGROUND_SEEN)||[],o={},a=0;a<t.length;a++)r.indexOf(n[t[a]])===-1&&(o[t[a]]=n[t[a]]);return o}}function u(){chrome.tabs.onCreated.addListener(function(){f=i,i++,2===i&&s.a.set(c.a.STORAGE.SEEN_ONBOARDING,!0)})}var s=n(0),c=n(1),i=0,f=0,g=void 0,l=!0;chrome.runtime.onMessage.addListener(function(e,t,n){return"getBackground"===e.query?m(e.theme,e.newPage):"getTabsCount"===e.query?n(r()):"setTabsCount"===e.query?(o(e.value),n(!0)):"loadNextBackground"===e.query?p(e.url):"loadCurrentBackground"===e.query?d(e.url,n):"log"===e.query&&N(e.value),!0});var d=function(e,t){var n=!1,r=new Image;r.src=e,r.onload=function(){n||(clearTimeout(o),t(e))};var o=setTimeout(function(){n=!0,t(!1)},2500)},m=function(e,t){return new Promise(function(n,r){var o=new XMLHttpRequest,u=s.a.get(c.a.STORAGE.CURRENT_PAGE)||{},i=u[e.value]||0;t&&i++;var f="http://api.subtletab.com/theme/";f+=e.tags+"/"+i,o.open("GET",f),o.setRequestHeader("chrome-extension",btoa(chrome.runtime.id)),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var t=JSON.parse(o.responseText);g=a(t),i===t.pages&&(i=0),u[e.value]=i,s.a.set("current-page",u),h(g,e),n()}},o.onerror=function(){r(o.status)},o.send()})},h=function(e,t){var n=s.a.get(c.a.THEME[t.value]);if(!n)return void s.a.set(t.value,e);var r=Object.keys(n),o=r[r.length],a=n[o],u={};u[o]=a,s.a.set(t.value,Object.assign({},u,e))},v=void 0,p=function(e){if(v=v||e,v!==e){N("BG: Load Next Background for",e),v=e;var t=new Image;t.src=e}},N=function(e){l&&console.log(e)};chrome.runtime.onInstalled.addListener(function(e){e&&e.reason&&"install"==e.reason?chrome.tabs.create({}):e&&e.reason&&"update"==e.reason&&(s.a.set(c.a.STORAGE.SEEN_ONBOARDING,!1),chrome.tabs.create({}))}),chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.create()}),chrome.storage.onChanged.addListener(function(e,t){var n=void 0;for(n in e)e.hasOwnProperty(n)&&(N("Storage Changed"+JSON.stringify(e[n])),s.a.setLocal(n,e[n].newValue))}),u()}});