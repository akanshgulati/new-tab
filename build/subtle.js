!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,t,n){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/build/",t(t.s=37)}({0:function(e,t,n){"use strict";var r=n(1),o={get:function(e){var t=localStorage.getItem(e);return isNaN(t)?JSON.parse(t):t},set:function(e,t){if(r.a.SYNC.indexOf(e)>-1||e.indexOf("note-")>-1){var n={};n[e]=t,chrome.storage.sync.set(n)}localStorage.setItem(e,JSON.stringify(t))},setLocal:function(e,t){localStorage.setItem(e,JSON.stringify(t))},remove:function(e){return localStorage.removeItem(e)},increment:function(e){var t=this.get(e);"number"==typeof t&&this.set(e,t+1)},append:function(e,t){var n=this.get(e)||[];n.push(t),this.set(e,n)},getMap:function(e){var t=localStorage.getItem(e);return isNaN(t)?JSON.parse(t):t},setMap:function(e,t){return localStorage.setItem(e,JSON.stringify(t))},chromeSync:{get:function(e,t){try{chrome.storage.sync.get(e,function(e){t&&t(e)})}catch(e){console.log(e)}},set:function(e,t,n){try{var r={};r[e]=t,chrome.storage.sync.set(r,function(e){n&&n(e)})}catch(e){console.log(e)}}}};t.a=o},1:function(e,t,n){"use strict";t.a={THEME:{NATURE:"nature",ARCHITECTURE:"building",TRAVEL:"travel",NIGHT:"night"},STORAGE:{SHARED_DATA:"shared-data",WEATHER:"weather",BACKGROUND_SEEN_NIGHT:"bg-seen-night",BACKGROUND_SEEN_TRAVEL:"bg-seen-travel",BACKGROUND_SEEN_BUILDING:"bg-seen-building",BACKGROUND_SEEN_NATURE:"bg-seen-nature",CURRENT_PAGE:"current-page",SEEN_ONBOARDING:"seen-onboarding",NOTES_META:"notes_meta"},SYNC:["shared-data","bg-seen-nature","bg-seen-night","bg-seen-travel","bg-seen-building","current-page","nature","travel","building","night","notes_meta","notes-"]}},37:function(e,t,n){e.exports=n(5)},5:function(e,t,n){"use strict";function r(){return h!==d&&d}function o(e){d=e}function a(e){if(e&&e.photo){for(var t=Object.keys(e.photo),n=e.photo,r=g.a.get(f.a.STORAGE.BACKGROUND_SEEN)||[],o={},a=0;a<t.length;a++)r.indexOf(n[t[a]])===-1&&(o[t[a]]=n[t[a]]);return o}}function s(e,t){var n=new XMLHttpRequest,r="http://api.subtletab.com/weather/";r+="?lat="+e+"&long="+t,n.open("GET",r),n.setRequestHeader("chrome-extension",btoa(chrome.runtime.id)),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=JSON.parse(n.responseText),t=+new Date,r=[t,e.temp,e.alt.temp,e.code,e.city];g.a.set("weather",r)}},n.send()}function i(){navigator.geolocation.getCurrentPosition(function(e){s(e.coords.latitude,e.coords.longitude)},function(e){R(e)},{timeout:1e4})}function u(){var e=g.a.get(f.a.STORAGE.SHARED_DATA);e&&e.showUtilities.showWeather?b||(b=setInterval(function(){navigator.onLine?i():c()},3e5)):c()}function c(){clearInterval(b)}function l(){chrome.runtime.setUninstallURL("https://goo.gl/forms/hMD1i4sXIUVwkKtD2"),chrome.storage.sync.get(null,function(e){for(var t in e)e.hasOwnProperty(t)&&g.a.setLocal(t,e[t])}),chrome.tabs.onCreated.addListener(function(){h=d,d++,2===d&&g.a.set(f.a.STORAGE.SEEN_ONBOARDING,!0)})}var g=n(0),f=n(1),d=0,h=0,v=void 0,m=!1;chrome.runtime.onMessage.addListener(function(e,t,n){return"getBackground"===e.query?p(e.theme,e.newPage):"getTabsCount"===e.query?n(r()):"setTabsCount"===e.query?(o(e.value),n(!0)):"loadNextBackground"===e.query?S(e.url):"loadCurrentBackground"===e.query?E(e.url,n):"log"===e.query?R(e.value):"startWeather"===e.query&&u(),!0});var E=function(e,t){var n=!1,r=new Image;r.src=e,r.onload=function(){n||(clearTimeout(o),t(e))};var o=setTimeout(function(){n=!0,t(!1)},2500)},p=function(e,t){return new Promise(function(n,r){var o=new XMLHttpRequest,s=g.a.get(f.a.STORAGE.CURRENT_PAGE)||{},i=s[e.value]||0;t&&i++;var u="http://api.subtletab.com/theme/";u+=e.tags+"/"+i,o.open("GET",u),o.setRequestHeader("chrome-extension",btoa(chrome.runtime.id)),o.onreadystatechange=function(){if(4===o.readyState&&200===o.status){var r=JSON.parse(o.responseText);v=a(r),i===r.pages&&(i=0),t&&g.a.set(f.a.STORAGE["BACKGROUND_SEEN_"+e.value.toUpperCase()],""),s[e.value]=i,g.a.set(f.a.STORAGE.CURRENT_PAGE,s),N(v,e),n()}},o.onerror=function(){r(o.status)},o.send()})},N=function(e,t){var n=g.a.get(f.a.THEME[t.value]);if(!n)return void g.a.set(t.value,e);var r=Object.keys(n),o=r[r.length],a=n[o],s={};s[o]=a,g.a.set(t.value,Object.assign({},s,e))},O=void 0,S=function(e){if(O=O||e,O!==e){R("BG: Load Next Background for",e),O=e;var t=new Image;t.src=e}},R=function(e){m&&console.log(e)};chrome.runtime.onInstalled.addListener(function(e){e&&e.reason&&"install"===e.reason?(g.a.chromeSync.get(null,function(e){var t=void 0;for(t in e)e.hasOwnProperty(t)&&g.a.setLocal(t,e[t])}),chrome.tabs.create({})):e&&e.reason&&"update"===e.reason&&g.a.set(f.a.STORAGE.SEEN_ONBOARDING,!1)}),chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.create({})}),chrome.storage.onChanged.addListener(function(e,t){var n=void 0;for(n in e)e.hasOwnProperty(n)&&(R("Storage Changed"+JSON.stringify(e[n])),e[n].newValue?g.a.setLocal(n,e[n].newValue):g.a.remove(n))});var b=void 0;l()}});