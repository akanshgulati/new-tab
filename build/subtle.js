!function(e){function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,t,n){Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/build/",t(t.s=37)}({0:function(e,t,n){"use strict";var o=n(1),a={get:function(e){var t=localStorage.getItem(e);return isNaN(t)?JSON.parse(t):t},set:function(e,t){if(o.a.SYNC.indexOf(e)>-1||e.indexOf("note-")>-1){var n={};n[e]=t,chrome.storage.sync.set(n)}localStorage.setItem(e,JSON.stringify(t))},setLocal:function(e,t){localStorage.setItem(e,JSON.stringify(t))},remove:function(e){return localStorage.removeItem(e)},increment:function(e){var t=this.get(e);"number"==typeof t&&this.set(e,t+1)},append:function(e,t){var n=this.get(e)||[];n.push(t),this.set(e,n)},getMap:function(e){var t=localStorage.getItem(e);return isNaN(t)?JSON.parse(t):t},setMap:function(e,t){return localStorage.setItem(e,JSON.stringify(t))},chromeSync:{get:function(e,t){try{chrome.storage.sync.get(e,function(e){t&&t(e)})}catch(e){console.log(e)}},set:function(e,t,n){try{var o={};o[e]=t,chrome.storage.sync.set(o,function(e){n&&n(e)})}catch(e){console.log(e)}}}};t.a=a},1:function(e,t,n){"use strict";t.a={THEME:{NATURE:"nature",ARCHITECTURE:"building",TRAVEL:"travel",NIGHT:"night"},STORAGE:{SHARED_DATA:"shared-data",WEATHER:"weather",BACKGROUND_SEEN_NIGHT:"bg-seen-night",BACKGROUND_SEEN_TRAVEL:"bg-seen-travel",BACKGROUND_SEEN_BUILDING:"bg-seen-building",BACKGROUND_SEEN_NATURE:"bg-seen-nature",CURRENT_PAGE:"current-page",SEEN_ONBOARDING:"seen-onboarding",NOTES_META:"notes_meta"},SYNC:["shared-data","bg-seen-nature","bg-seen-night","bg-seen-travel","bg-seen-building","current-page","nature","travel","building","night","notes_meta","notes-"]}},2:function(e,t,n){"use strict";var o={defaultCustomization:{showUtilities:{showWeather:!0,showClock:!0},clock:{showTwelveHour:!0,showDay:!0},weather:{unit:"c",location:{type:"geo",name:""}},background:{themeId:1,changeInterval:10}}};t.a=o},37:function(e,t,n){e.exports=n(5)},5:function(e,t,n){"use strict";function o(){return v!==m&&m}function a(e){m=e}function r(e){if(e&&e.photo){for(var t=Object.keys(e.photo),n=e.photo,o=f.a.get(h.a.STORAGE.BACKGROUND_SEEN)||[],a={},r=0;r<t.length;r++)o.indexOf(n[t[r]])===-1&&(a[t[r]]=n[t[r]]);return a}}function i(e){var t=new XMLHttpRequest,n="https://api.subtletab.com/weather/new";n+="custom"!==e.type?"?lat="+e.lat+"&long="+e.long+"&type=geo":"?location="+e.location+"&type=custom",t.open("GET",n),t.setRequestHeader("chrome-extension",btoa(chrome.runtime.id)),t.onreadystatechange=function(){if(4===t.readyState&&200===t.status){var e=JSON.parse(t.responseText),n=+new Date,o=[n,e.temp,e.alt.temp,e.code,e.city];f.a.set("weather",o)}},t.send()}function s(e){var t={};"custom"!==e.weather.type?navigator.geolocation.getCurrentPosition(function(e){t={lat:e.coords.latitude,long:e.coords.longitude,type:"geo"},i(t)},function(e){T(e)},{timeout:1e4}):(t={location:e.weather.location,type:"custom"},i(t))}function u(){var e=f.a.get(h.a.STORAGE.SHARED_DATA);e&&e.showUtilities.showWeather?y||(y=setInterval(function(){navigator.onLine?(e=f.a.get(h.a.STORAGE.SHARED_DATA),s(e)):c()},3e5)):c()}function c(){clearInterval(y)}function l(){var e=void 0;f.a.set(h.a.STORAGE.SEEN_ONBOARDING,!1),e=f.a.get(h.a.STORAGE.SHARED_DATA),e&&(e.weather.location||(e.weather.location=d.a.defaultCustomization.weather.location,e.weather.location.name=f.a.get(h.a.STORAGE.WEATHER)[4]||"")),f.a.set(h.a.STORAGE.SHARED_DATA,e)}function g(){chrome.runtime.setUninstallURL("https://goo.gl/forms/hMD1i4sXIUVwkKtD2"),chrome.storage.sync.get(null,function(e){for(var t in e)e.hasOwnProperty(t)&&f.a.setLocal(t,e[t])}),chrome.tabs.onCreated.addListener(function(){v=m,m++,2===m&&f.a.set(h.a.STORAGE.SEEN_ONBOARDING,!0)})}var f=n(0),h=n(1),d=n(2),m=0,v=0,E=void 0,p=!1;chrome.runtime.onMessage.addListener(function(e,t,n){return"getBackground"===e.query?S(e.theme,e.newPage):"getTabsCount"===e.query?n(o()):"setTabsCount"===e.query?(a(e.value),n(!0)):"loadNextBackground"===e.query?R(e.url):"loadCurrentBackground"===e.query?A(e.url,n):"log"===e.query?T(e.value):"startWeather"===e.query&&u(),!0});var A=function(e,t){var n=!1,o=new Image;o.src=e,o.onload=function(){n||(clearTimeout(a),t(e))};var a=setTimeout(function(){n=!0,t(!1)},2500)},S=function(e,t){return new Promise(function(n,o){var a=new XMLHttpRequest,i=f.a.get(h.a.STORAGE.CURRENT_PAGE)||{},s=i[e.value]||0;t&&s++;var u="https://api.subtletab.com/theme/";u+=e.tags+"/"+s,a.open("GET",u),a.setRequestHeader("chrome-extension",btoa(chrome.runtime.id)),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var o=JSON.parse(a.responseText);E=r(o),s===o.pages&&(s=0),t&&f.a.set(h.a.STORAGE["BACKGROUND_SEEN_"+e.value.toUpperCase()],""),i[e.value]=s,f.a.set(h.a.STORAGE.CURRENT_PAGE,i),N(E,e),n()}},a.onerror=function(){o(a.status)},a.send()})},N=function(e,t){var n=f.a.get(h.a.THEME[t.value]);if(!n)return void f.a.set(t.value,e);var o=Object.keys(n),a=o[o.length],r=n[a],i={};i[a]=r,f.a.set(t.value,Object.assign({},i,e))},O=void 0,R=function(e){if(O=O||e,O!==e){T("BG: Load Next Background for",e),O=e;var t=new Image;t.src=e}},T=function(e){p&&console.log(e)};chrome.runtime.onInstalled.addListener(function(e){e&&e.reason&&"install"===e.reason?(f.a.chromeSync.get(null,function(e){var t=void 0;for(t in e)e.hasOwnProperty(t)&&f.a.setLocal(t,e[t])}),chrome.tabs.create({})):e&&e.reason&&"update"===e.reason&&l()}),chrome.browserAction.onClicked.addListener(function(e){chrome.tabs.create({})}),chrome.storage.onChanged.addListener(function(e,t){var n=void 0;for(n in e)e.hasOwnProperty(n)&&(T("Storage Changed"+JSON.stringify(e[n])),e[n].newValue?f.a.setLocal(n,e[n].newValue):f.a.remove(n))});var y=void 0;g()}});