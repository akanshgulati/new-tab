{"version":3,"sources":["webpack:///webpack/bootstrap b4922ec680ffd6ee0ab7","webpack:///./src/subtle.js"],"names":["tabsCount","bgData","storage","get","key","value","localStorage","getItem","isNaN","JSON","parse","set","data","setItem","stringify","remove","removeItem","getTabsCount","setTabsCount","num","filterResponses","response","photo","photoKeys","Object","keys","photos","storedSeenIds","result","i","length","indexOf","chrome","runtime","onMessage","addListener","request","sender","sendResponse","query","getBackground","theme","then","loadBackground","url","Promise","resolve","reject","xmlhttp","XMLHttpRequest","currentPage","themePage","tags","open","setRequestHeader","btoa","id","onreadystatechange","readyState","status","responseText","pages","onerror","send","previousURL","image","Image","src","onInstalled","details","reason","tabs","create","browserAction","onClicked","tab","init","onCreated"],"mappings":"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","file":"subtle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/build/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 29);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b4922ec680ffd6ee0ab7","let tabsCount = 0;\nlet bgData;\nlet storage = {\n    get(key){\n        let value = localStorage.getItem(key);\n        return isNaN(value) ? JSON.parse(value) : value;\n    },\n    set(key, data){\n        return localStorage.setItem(key, JSON.stringify(data));\n    },\n    remove(key){\n        return localStorage.removeItem(key);\n    }\n};\n\n\nfunction getTabsCount() {\n    return tabsCount;\n}\n\nfunction setTabsCount(num) {\n    tabsCount = num;\n}\n\nfunction filterResponses(response) {\n    if (response && response.photo) {\n        let photoKeys = Object.keys(response.photo);\n        let photos = response.photo;\n        let storedSeenIds = storage.get('bg-seen') || [];\n        let result = {};\n        for (let i = 0; i < photoKeys.length; i++) {\n            if (storedSeenIds.indexOf(photos[photoKeys[i]]) === -1) {\n                result[photoKeys[i]] = photos[photoKeys[i]];\n            }\n        }\n        return result;\n    }\n}\nchrome.runtime.onMessage.addListener(\n    (request, sender, sendResponse) => {\n        if (request.query === 'getBackground') {\n            getBackground(request.theme).then(()=>{\n                if(sendResponse && typeof sendResponse === 'function'){\n                    sendResponse(true);\n                }\n            });\n        }\n        else if (request.query === 'getTabsCount') {\n            sendResponse(tabsCount);\n        } else if (request.query === 'setTabsCount') {\n            setTabsCount(request.value);\n            sendResponse(true);\n        }else if(request.query === 'loadBackground'){\n            loadBackground(request.url);\n        }\n        return true;\n    });\n\n\nlet getBackground = (theme) => {\n    return new Promise((resolve, reject) => {\n        let xmlhttp = new XMLHttpRequest();\n        let currentPage = storage.get('current-page') || {};\n        let themePage = (currentPage[theme.value] && (+currentPage[theme.value] + 1)) || 1;\n        let url = 'http://ec2-52-74-214-57.ap-southeast-1.compute.amazonaws.com/';\n        url += theme.tags + '/' + themePage;\n        xmlhttp.open('GET', url);\n        xmlhttp.setRequestHeader('chrome-extension', btoa(chrome.runtime.id));\n        xmlhttp.onreadystatechange = function () {\n            if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {\n                let response = JSON.parse(xmlhttp.responseText);\n                //responses will be other than seen, having good views and sizes\n                bgData = filterResponses(response);\n                //If all pages are empty;\n                if(currentPage === response.pages){\n                    currentPage = 0;\n                }\n                currentPage[theme.value] = themePage;\n                storage.set('current-page', currentPage);\n                /*if (Object.keys(bgData).length < 10 && response.pages > page) {\n                 getBackground(theme, callback, page + 1);\n                 } else {*/\n                storage.set(theme.value, bgData);\n                resolve();\n            }\n        };\n        xmlhttp.onerror = ()=>{\n            reject(xmlhttp.status);\n        };\n        xmlhttp.send();\n    });\n};\nlet previousURL;\nlet loadBackground = function(url){\n    previousURL = previousURL || url;\n    if(previousURL !== url) {\n        previousURL = url;\n        let image = new Image();\n        image.src = url;\n    }\n};\nchrome.runtime.onInstalled.addListener(function (details) {\n    if (details && details.reason && details.reason == 'install') {\n        chrome.tabs.create({url: \"index.html\"});\n    }\n});\n\nchrome.browserAction.onClicked.addListener(function (tab) {\n    chrome.tabs.create({url: \"index.html\"});\n});\n\nfunction init() {\n    chrome.tabs.onCreated.addListener(function () {\n        tabsCount++;\n        if (tabsCount === 2) {\n            storage.set('seen-onboarding', true);\n        }\n    });\n}\ninit();\n\n\n// WEBPACK FOOTER //\n// ./src/subtle.js"],"sourceRoot":""}